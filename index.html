<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Magnet Pro v6.2 | Deep Cloud Scraper</title>
    <style>
        :root {
            --primary: #6366f1; --secondary: #a855f7; --success: #10b981;
            --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7); --text: #f1f5f9;
        }
        body {
            font-family: 'Inter', sans-serif; background: var(--bg);
            background-image: radial-gradient(circle at top right, #1e1b4b, #0f172a);
            color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh;
        }
        .container {
            max-width: 900px; width: 100%; background: var(--card-bg); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px; padding: 40px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        h1 { text-align: center; font-size: 2.2rem; background: linear-gradient(to right, #818cf8, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #94a3b8; font-size: 0.85rem; margin-bottom: 30px; }
        .input-group { background: rgba(255, 255, 255, 0.03); padding: 25px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.05); margin-bottom: 20px; }
        label { display: block; font-size: 0.7rem; text-transform: uppercase; color: #a5b4fc; margin-bottom: 8px; font-weight: 700; }
        textarea, input, select { width: 100%; background: rgba(15, 23, 42, 0.6); border: 1px solid #334155; color: white; padding: 12px; border-radius: 10px; font-size: 14px; box-sizing: border-box; outline: none; margin-bottom: 15px; }
        .config-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .btn { border: none; padding: 16px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 14px; width: 100%; }
        .btn-primary { background: linear-gradient(to right, var(--primary), var(--secondary)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3); }
        #output-container { margin-top: 30px; background: #020617; border-radius: 16px; padding: 20px; border: 1px solid #1e293b; }
        #output { color: #10b981; font-family: 'Fira Code', monospace; font-size: 13px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; margin-top: 10px; }
        .badge { background: var(--primary); color: white; padding: 3px 10px; border-radius: 8px; font-size: 0.8rem; }
        #status { text-align: center; font-size: 0.85rem; margin-top: 10px; color: #94a3b8; min-height: 20px; }
        .loader { color: var(--secondary); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>Lead Magnet Pro v4</h1>
    <p class="subtitle">Deep Cloud Scrape Mode (Multi-Page Support)</p>

    <div class="input-group">
        <label>Target Keywords (comma separated)</label>
        <textarea id="keywords" rows="2" placeholder="e.g. LLC Owner, Startup Founder"></textarea>
        
        <div class="config-grid">
            <div>
                <label>Country</label>
                <input type="text" id="location" placeholder="e.g. USA">
            </div>
            <div>
                <label>Platform</label>
                <select id="platform">
                    <option value="site:instagram.com">Instagram</option>
                    <option value="site:linkedin.com/in/">LinkedIn</option>
                    <option value="site:tiktok.com">TikTok</option>
                    <option value="site:facebook.com">Facebook</option>
                </select>
            </div>
            <div>
                <label>Email</label>
                <select id="emailProvider">
                    <option value="@gmail.com">@gmail.com</option>
                    <option value="@outlook.com">@outlook.com</option>
                    <option value="@yahoo.com">@yahoo.com</option>
                    <option value='member of "@"'>Any @</option>
                </select>
            </div>
            <div>
                <label>Pages (max 10 per page)</label>
                <select id="pages">
                    <option value="1">1 Page</option>
                    <option value="2">2 Pages</option>
                    <option value="3">3 Pages</option>
                    <option value="5">5 Pages (Deep)</option>
                </select>
            </div>
        </div>

        <button class="btn btn-primary" onclick="runDeepScrape()">
            üöÄ Start Deep Cloud Scrape
        </button>
        <div id="status">Status: Ready</div>
    </div>

    <div id="output-container">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span>Total Leads: <b id="count" class="badge">0</b></span>
            <div style="display: flex; gap: 10px;">
                <button onclick="copyResults()" style="background: transparent; border: 1px solid #334155; color: #a5b4fc; padding: 5px 12px; border-radius: 8px; cursor: pointer; font-size: 12px;">Copy</button>
                <button onclick="clearAll()" style="background: transparent; border: 1px solid rgba(239,68,68,0.3); color: #ef4444; padding: 5px 12px; border-radius: 8px; cursor: pointer; font-size: 12px;">Clear</button>
            </div>
        </div>
        <div id="output">Results will appear here...</div>
    </div>
</div>

<script>
    const delay = ms => new Promise(res => setTimeout(res, ms));

    async function runDeepScrape() {
        const keywordsInput = document.getElementById('keywords').value;
        const location = document.getElementById('location').value;
        const platform = document.getElementById('platform').value;
        const email = document.getElementById('emailProvider').value;
        const maxPages = parseInt(document.getElementById('pages').value);
        const status = document.getElementById('status');

        if(!keywordsInput) { alert("Enter keywords!"); return; }

        const keywordsArray = keywordsInput.split(',').map(k => k.trim()).filter(k => k !== "");
        const combinedKeywords = keywordsArray.map(k => `"${k}"`).join(' OR ');
        
        status.innerHTML = `<span class="loader">‚öôÔ∏è Initializing Deep Scrape...</span>`;
        
        for (let i = 0; i < maxPages; i++) {
            const startAt = i * 100;
            status.innerHTML = `<span class="loader">‚è≥ Scraping Page ${i + 1} of ${maxPages} (Results ${startAt}-${startAt + 100})...</span>`;
            
            // Budowanie zapytania z parametrem &start=
            let query = `${platform} (${combinedKeywords}) `;
            if(location) query += `"${location}" `;
            query += `"${email}"`;

            const googleUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}&num=100&start=${startAt}`;
            const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(googleUrl)}`;

            try {
                const response = await fetch(proxyUrl);
                const html = await response.text();

                if (html.includes("detected unusual traffic")) {
                    status.innerHTML = `<span style="color:#ef4444">‚ùå Blocked by Google on page ${i+1}. Try again later or use fewer pages.</span>`;
                    break; 
                }

                extractEmails(html);
                
                // Czekamy 3 sekundy miƒôdzy stronami, ≈ºeby byƒá "bezpieczniejszym"
                if (i < maxPages - 1) await delay(3000);

            } catch (err) {
                status.innerHTML = `<span style="color:#ef4444">‚ùå Proxy Error on page ${i+1}.</span>`;
                break;
            }
        }
        
        if (!status.innerHTML.includes("‚ùå")) {
            status.innerHTML = `<span style="color:#10b981">‚úÖ Deep Scrape Complete!</span>`;
        }
    }

    function extractEmails(newHtml) {
        const emailRegex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g;
        const foundEmails = newHtml.match(emailRegex) || [];
        const outputDiv = document.getElementById('output');
        const countSpan = document.getElementById('count');

        let existingContent = outputDiv.innerText;
        let existingEmails = (existingContent.includes("@")) ? existingContent.split('\n') : [];

        const combined = [...existingEmails, ...foundEmails];
        const uniqueEmails = [...new Set(combined.map(e => e.trim().toLowerCase()))];

        if (uniqueEmails.length > 0) {
            outputDiv.innerText = uniqueEmails.join('\n');
            countSpan.innerText = uniqueEmails.length;
        }
    }

    function clearAll() {
        document.getElementById('output').innerText = "Results will appear here...";
        document.getElementById('count').innerText = "0";
        document.getElementById('status').innerText = "Status: Cleared";
    }

    function copyResults() {
        const text = document.getElementById('output').innerText;
        if(text.includes("@")) {
            navigator.clipboard.writeText(text).then(() => alert("Copied!"));
        }
    }
</script>

</body>
</html>
